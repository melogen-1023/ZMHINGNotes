## 网络层

> 数据传输单元是分组



##### 自治系统AS

每个路由都会划分一个自治系统，具有相对独立性。



### IP协议

#### IP分组

由于以太网链路层最大数据单元为**1500字节**，所以在分组过大时需要对IP分组的数据部分进行分片，然后在每个分片前添加各自的首部

**IP首部必须是4B的整数倍**

**IP分片必须是8B的整数倍**





##### IP协议中的A、B、C类地址

| 类别 | 长度划分                                       |
| ---- | ---------------------------------------------- |
| A    | 一共32位，分为网络号和主机号。前8位为网络号。  |
| B    | 一共32位，分为网络号和主机号。前16位为网络号。 |
| C    | 一共32位，分为网络号和主机号。前24位为网络号。 |





#### 网络地址转换NAT

NAT路由器负责专用网内的主机向外发送请求的工作

根据NAT转换表**修改**专用网内的主机发送来的分组中的源IP地址以达到**访问WAN网**的目的

一个转换表的示例：

| WAN 端           | LAN 端            |
| ---------------- | ----------------- |
| 172.38.1.5:40001 | 192.168.0.3:30000 |

252 = 11111100 

77 = 01001101

252&77 = 01001100 = 64+8+4=76





#### ICMP、ARP协议

ICMP是差错报告协议



ARP是广播协议，是用来根据IP地址获取目标的MAC地址的协议



#### 路由选择协议

##### RIP

内部网关协议

##### OSPF

内部网关协议

##### OGP

外部网关协议



#### IP组播

IP组播使用D类地址，组播地址只能作为目的地址

**IP组播地址前4位为1110，然后紧接着是5位地址用于组播地址分类，后23位用于主机号**



**IP组播地址的后23位映射到MAC地址的后23位**

> 这种映射会出现问题：不同组播地址下的相同主机号的主机所映射的MAC地址会是相同的，所以一个主机会收到不同组播地址发送的MAC帧，所以需要在网络层对其进行过滤才能保证数据正确。



##### IGMP

用于通知路由器某个主机加入或退出组播的协议